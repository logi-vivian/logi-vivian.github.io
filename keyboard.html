<!doctype HTML>
<html>
<head>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {color: white; font-family: 'Poppins', sans-serif;}
        #map {
            height: 60%;
            display: none;
            top: 15%;
            left: 25%;
            width: 60%;
            background-color: white;
            justify: center;
        }
        /* Optional: Makes the sample page fill the window. */
        /*html, body {*/

        /*    height: 100%;*/
        /*    margin: 0;*/
        /*    background-color: black;*/
        /*    padding: 0;*/
        /*}*/


    </style>
    <link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet">


</head>

<script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
<script src="https://rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
<script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
<script src="https://unpkg.com/aframe-particleplayer-component/dist/aframe-particleplayer-component.min.js"></script>
<script>
    var map;
    var service;
    var infowindow;
    var lat = 37.539;
    var long = -122.062;


    function initMap() {
        var start = new google.maps.LatLng(lat, long);

        infowindow = new google.maps.InfoWindow();

        map = new google.maps.Map(
            document.getElementById('map'), {center: start, zoom: 12,
                styles: [
                    {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
                    {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
                    {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
                    {
                        featureType: 'administrative.locality',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#d59563'}]
                    },
                    {
                        featureType: 'poi',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#d59563'}]
                    },
                    {
                        featureType: 'poi.park',
                        elementType: 'geometry',
                        stylers: [{color: '#263c3f'}]
                    },
                    {
                        featureType: 'poi.park',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#6b9a76'}]
                    },
                    {
                        featureType: 'road',
                        elementType: 'geometry',
                        stylers: [{color: '#38414e'}]
                    },
                    {
                        featureType: 'road',
                        elementType: 'geometry.stroke',
                        stylers: [{color: '#212a37'}]
                    },
                    {
                        featureType: 'road',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#9ca5b3'}]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'geometry',
                        stylers: [{color: '#746855'}]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'geometry.stroke',
                        stylers: [{color: '#1f2835'}]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#f3d19c'}]
                    },
                    {
                        featureType: 'transit',
                        elementType: 'geometry',
                        stylers: [{color: '#2f3948'}]
                    },
                    {
                        featureType: 'transit.station',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#d59563'}]
                    },
                    {
                        featureType: 'water',
                        elementType: 'geometry',
                        stylers: [{color: '#17263c'}]
                    },
                    {
                        featureType: 'water',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#515c6d'}]
                    },
                    {
                        featureType: 'water',
                        elementType: 'labels.text.stroke',
                        stylers: [{color: '#17263c'}]
                    }
                ]

            });

        var request = {
            location: start,
            radius: 10000,
            keyword: "recycle"
        };

        service = new google.maps.places.PlacesService(map);

        service.nearbySearch(request, function(results, status) {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                for (var i = 0; i < results.length; i++) {
                    console.log(results[i])
                    createMarker(results[i]);
                }

                map.setCenter(results[0].geometry.location);
            }
        });
    }

    function createMarker(place) {
        var marker = new google.maps.Marker({
            map: map,
            position: place.geometry.location
        });

        google.maps.event.addListener(marker, 'click', function() {
            infowindow.setContent(place.name);
            infowindow.open(map, this);
        });
    }

    function regenerateMat() {
        lat = document.getElementById("enterLat").value;
        console.log(lat);
        long = document.getElementById("enterLong").value;
        initMap();

    }
</script>

<script>

    THREEx.ArToolkitContext.baseURL = 'https://rawgit.com/jeromeetienne/ar.js/master/three.js/';

    AFRAME.registerComponent('trigger', {
        init: function () {
            document.addEventListener('keydown', evt => {
                if (evt.keyCode === 32) {
                    this.trigger();
                }
            });
            document.addEventListener('click', () => {
                this.trigger();
            });
        },

        trigger: function () {
            this.el.emit('particleplayerstart', {
                position: new THREE.Vector3(
                    (Math.random() - 0.5) * 7,
                    Math.random() * 2,
                    -5 - Math.random() * 2
                ),
                rotation: new THREE.Euler(Math.random() * 1 - .5, 0, 0)
            });
        }
    });

    AFRAME.registerComponent('triggerMap', {
        init: function () {
            console.log("triggerMap yep");

        }
    });

    AFRAME.registerComponent('registerevents', {
        init: function () {
            var marker = this.el;

            marker.addEventListener('markerFound', function () {
                var markerId = marker.id;
                // console.log('markerFound', markerId);
                text = marker.children[0];

                document.getElementById("infoImg").src = text.getAttribute('data-infoImgSrc');

                document.getElementById("testtext").innerText = text.getAttribute('data-textValue');

                if (markerId == 0) {
                    document.getElementById("map").style.display = 'block';
                }



            });
            marker.addEventListener('markerLost', function () {
                document.getElementById("map").style.display = 'none';
            });

        }
    });


</script>

<body style='margin : 0; overflow: hidden;'>


<div id="map"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCS35U6_6_LwZCpeeRSid3qs2opoydzo8E&libraries=places&callback=initMap" async defer></script>


<div id="modal" style='position: absolute; width:100%; bottom: 0; height: 60%; overflow: hidden; opacity: 0.8; text-align: center; z-index: 0;'>
    <p id="testtext" style="font-size:5em;">Welcome to G910.</p>
    <img src="onboarding0.gif" style="justify-content: center;" id="infoImg" width="50%">

</div>



<!-- we add detectionMode and matrixCodeType to tell AR.js to recognize barcode markers -->
<a-scene id="scene" cursor="rayOrigin: mouse" vr-mode-ui="enabled: false" embedded arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;'>


    <a-assets>
        <a-asset-item id="particlesJson" src="./particles-fireworks.json"></a-asset-item>
        <img src="./sprite.png" id="particleTex">
    </a-assets>

    <a-assets>
        <img id="spareparts" src="./spareparts.png">
    </a-assets>

    <a-assets>
        <img id="support" src="./support.png">
    </a-assets>

    <a-entity position="0 1 -5"
              trigger
              particleplayer="src: #particlesJson; img: #particleTex; dur: 4000; count: 50%; scale: 0.6; pscale: 1; interpolate: true; shader: standard; poolSize: 20"></a-entity>
    <a-entity position="0 1 -5"
              trigger
              particleplayer="src: #particlesJson; img: #particleTex; dur: 4000; count: 50%; scale: 0.6; pscale: 1; interpolate: true; shader: standard; poolSize: 20"></a-entity>


    <a-marker type='barcode' value='0' registerevents>
        <a-text id="text_three" data-infoImgSrc="onboarding1.gif" data-textValue="Text one" font="roboto" material='opacity: 0.5;'></a-text>
        <a-circle animation="property: scale; to: 1.2 1.2 1.2; loop: true; dur: 3000;"src="#support" radius="1" rotation="-90 0 0"></a-circle>
    </a-marker>



<!--    <a-marker type='barcode' value='1' registerevents>-->
<!--        <a-text id="text_one" data-infoImgSrc="onboarding2.gif" data-textValue="Text three" font="roboto" material='opacity: 0.5;'></a-text>-->

<!--        <a-box position='0 0.5 0' color="#00eeee" opacity="0.5"></a-box>-->
<!--        <a-box animation="property: color; to: #ff0000; loop:true; dur:5000" position='1.2 0.5 0' color="#00eeee" opacity="0.2"></a-box>-->
<!--        <a-box animation="property: color; to: #ffff00; loop:true; dur:5000" position='-1.2 0.5 0' color="#00eeee" opacity="0.2"></a-box>-->
<!--        <a-box animation="property: color; to: #ffffff; loop:true; dur:5000" position='0 0.5 1.2' color="#00eeee" opacity="0.2"></a-box>-->


<!--    </a-marker>-->

<!--    <a-marker type='barcode' value='2' registerevents>-->
<!--        <a-text id="text_two" data-infoImgSrc="onboarding3.gif" data-textValue="Text two" font="roboto" material='opacity: 0.5;'></a-text>-->
<!--        <a-circle animation="property: scale; to: 1.2 1.2 1.2; loop: true;"src="#spareparts" radius="1" rotation="-90 0 0"></a-circle>-->

<!--    </a-marker>-->


<!--    <a-marker type='barcode' value='0' triggerMap>-->
<!--        <a-text id="text_three" data-textValue="Nearest recycling centers" font="roboto" material='opacity: 0.5;'></a-text>-->
<!--    </a-marker>-->

<!--    <a-marker type='barcode' value="4" triggermap>-->
<!--        <a-text id="text_four" data-infoImgSrc="onboarding4.gif" data-textValue="Text three" font="roboto" material='opacity: 0.5;'></a-text>-->
<!--    </a-marker>-->


    <!-- use this <a-entity camera> to support multiple-markers, otherwise use <a-marker-camera> instead of </a-marker> -->
    <a-entity camera></a-entity>
</a-scene>


</body>
</html>
